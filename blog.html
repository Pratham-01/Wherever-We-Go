<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular.min.js"></script>
        <!--script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular-route.min.js"></script-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="/css/blog.css" type="text/css">
    </head>

    <body ng-app = "myApp" ng-controller = "MyController">
        <div id="navbar">
            <ul class="nav nav-pills">
                
                <li class="nav-item">
                    <a class="nav-link" href="/">Home</a>
                </li>

                    <!--li class="nav-item" ng-show="user">
                        <a class="nav-link" href="">Requests</a>
                    </li-->
                    <li class="nav-item" ng-show="user">
                        <a class="nav-link" href="/logout">Log Out</a>
                    </li>
                    <li class="nav-item" ng-show="user">
                        <a class="nav-link" href="">Signed in as <strong>{{ name }}</strong></a>
                    </li> 
                
                    <li class="nav-item" ng-hide="user">
                        <a class="nav-link" href="/login">Log In</a>
                    </li>
                    <li class="nav-item" ng-hide="user">
                        <a class="nav-link" href="/register">Register</a>
                    </li>
                
            </ul>
        </div>

            <div id="body" class="container">

                <h1>{{ blog.title }}</h1>
                <img  src="data:image/png;base64,{{ blog.imgs[0].image }}" alt="image" width="600px">
                <div>{{ blog.content }}</div>

                <img  src="data:image/png;base64,{{ blog.imgs[1].image }}" alt="image" width="600px">

                <h3>Image Gallery</h3>
                <div class="row">
                    <div class="col" ng-repeat="img in blog.imgs">
                        <img  src="data:image/png;base64,{{ img.image }}" alt="image" width="200px">
                    </div>
                </div>

                <div>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                </div>

                <form ng-show="user">

                    <span class="star-rating">
                        <input type="radio" name="rating1" value="1"><i></i>
                        <input type="radio" name="rating1" value="2"><i></i>
                        <input type="radio" name="rating1" value="3"><i></i>
                        <input type="radio" name="rating1" value="4"><i></i>
                        <input type="radio" name="rating1" value="5"><i></i>
                    </span>

                    <button type="submit" class="btn btn-sm btn-warning">Rate</button>
                </form>

                    
            </div>
    </body>
    
    <script>

            var app = angular.module('myApp',[]);
            app.controller("MyController", function($scope, $http) {


                $http({
                    method : "GET",
                    url : "/checkSession"
                })
                .success(function (data, status, headers, config) {
                    console.log("data returned ",data);
                    if (data) {
                      $scope.user = true;
                    } else {
                      $scope.user = false;
                    }
                })
                .error(function (data, status, header, config) {
                    $scope.ResponseDetails = "Data: " + data +
                        "<hr />status: " + status +
                        "<hr />headers: " + header +
                        "<hr />config: " + config;
                });

            $http({
                    method : "POST",
                    url : window.location.pathname
                })
                .success(function (data, status, headers, config) {
                    console.log("data returned ", data);
                    $scope.blog = data[0];
                })
                .error(function (data, status, header, config) {
                    $scope.ResponseDetails = "Data: " + data +
                        "<hr />status: " + status +
                        "<hr />headers: " + header +
                        "<hr />config: " + config;
                });

            });
            
          </script>

</html>